function createCookie(t, e, n) {
    var o;
    if (n) {
        var i = new Date;
        i.setTime(i.getTime() + 24 * n * 60 * 60 * 1e3), o = "; expires=" + i.toGMTString()
    } else o = "";
    document.cookie = encodeURIComponent(t) + "=" + encodeURIComponent(e) + o + "; path=/"
}

function readCookie(t) {
    for (var e = encodeURIComponent(t) + "=", n = document.cookie.split(";"), o = 0; o < n.length; o++) {
        for (var i = n[o];
            " " === i.charAt(0);) i = i.substring(1, i.length);
        if (0 === i.indexOf(e)) return decodeURIComponent(i.substring(e.length, i.length))
    }
    return null
}

function eraseCookie(t) {
    createCookie(t, "", -1)
}
jQuery(function(c) {
        "use strict";
        var d = !1,
            u = !1,
            o = 0;

        function t() {
            if (!(c(".js-infinity-scroll").length < 1) && o != infinity_scroll_archive_limit) {
                var t = b(),
                    e = _();
                if (!d && !u && t > e - 1.5 * document.documentElement.clientHeight) {
                    d = !0, c(".js-pagination-box").fadeOut(), c("#main").append('<div class="donut js-donut-loading-posts"></div>');
                    var n = {
                        action: "journalx_load_posts",
                        nonce: wps_ajax.nonce,
                        query_vars: query_vars,
                        current_page: current_page
                    };
                    jQuery.post(wps_ajax.url, n, function(t) {
                        if (d = !1, current_page++, current_page == max_pages && (u = !0), t) {
                            if (c("#main .post-boxes").append(t), ++o == infinity_scroll_archive_limit) {
                                var e = c(".js-pagination-box .nav-links a:last-child").attr("href");
                                e = e.replace(/page\/[0-9]+/g, "page/" + (current_page + 1)), c(".js-pagination-box .nav-links").html('<a class="next page-numbers" href="' + e + '">' + wps_ajax.str_load_more + "</a>"), c(".js-pagination-box").show()
                            }
                        } else u = !0;
                        c(".js-donut-loading-posts").remove()
                    })
                }
            }
        }
        c(window).scroll(function() {
            t()
        }), t();
        var p = c(".article-wrap").data("post-id"),
            h = c(".article-wrap").data("post-id"),
            m = p,
            g = "previous",
            f = !1,
            v = 0,
            w = [];

        function b() {
            return window.pageYOffset || document.documentElement.scrollTop
        }

        function _() {
            return Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight)
        }

        function e(t) {
            var e = c("#entry_comments_" + t),
                n = e.attr("data-loaded");
            if (e.is(":hidden")) {
                if (e.slideDown(), "true" != n) {
                    var o = {
                        action: "ajax_load_comments",
                        nonce: wps_ajax.nonce,
                        post_id: t
                    };
                    jQuery.post(wps_ajax.url, o, function(t) {
                        e.html(t), e.attr("data-loaded", "true"), jQuery("body").trigger(jQuery.Event("journalx_load_comments"))
                    })
                }
            } else e.slideUp()
        }

        function n() {
            c("body").css("margin-bottom", c(".site-footer").outerHeight() + 40)
        }
        w[p] = {
            title: document.title,
            url: window.location.href
        }, c(window).scroll(function() {
            if (c("body").hasClass("single") && infinity_scroll_single_enabled) {
                var n = b(),
                    t = _();
                if (!d && !u && n > t - 2 * document.documentElement.clientHeight) {
                    if (v == infinity_scroll_single_limit) return;
                    d = !0, c("#main").append('<div class="donut js-donut-loading-post"></div>');
                    var e = {
                        action: "journalx_load_post",
                        nonce: wps_ajax.nonce,
                        post_id: p,
                        start_post_id: m,
                        direct: g
                    };
                    jQuery.post(wps_ajax.url, e, function(t) {
                        if (d = !1, t.success) {
                            if (jQuery("body").trigger(jQuery.Event("journalx_load_post")), g != t.data.direct) {
                                if (f) return u = !0, void c(".js-donut-loading-post").remove();
                                f = !0
                            }
                            c("#main").append(t.data.html), w[t.data.post_id] = {
                                title: t.data.title,
                                url: t.data.url
                            }, g = t.data.direct, p = t.data.post_id, v++, void 0 !== window.instgrm && window.instgrm.Embeds.process(), void 0 !== window._goodshare && window._goodshare.reNewAllInstance()
                        } else u = !0;
                        c(".js-donut-loading-post").remove()
                    })
                }
                var o, i, a = "";
                if (c(".article-wrap").each(function() {
                        var t = c(this).offset().top,
                            e = c(this).attr("data-post-id");
                        t - 150 < n && (a = e)
                    }), a.length && a != h) {
                    a = parseInt(a);
                    var s = w[a].url,
                        r = w[a].title;
                    if (o = s, i = r, history.replaceState({
                            title: i,
                            url: o
                        }, i, o), document.title = i, h = a, "undefined" != typeof yandex_counter && yandex_counter.hit(s), "undefined" != typeof gtag && "undefined" != typeof ga_tracking_id && gtag("config", ga_tracking_id, {
                            page_path: s
                        }), c("#wpadminbar").length) {
                        var l = c("#wp-admin-bar-edit a").attr("href");
                        l = l.replace(/[0-9]+/g, a), c("#wp-admin-bar-edit a").attr("href", l)
                    }
                }
            }
        }), c(document).on("click", ".js-load-comments", function() {
            e(c(this).data("post-id"))
        }), c(document).on("click", ".js-meta-comments", function() {
            var t = c(this).parents(".js-post-container").data("post-id");
            c("html, body").animate({
                scrollTop: c(".entry-footer").offset().top
            }, 1e3), c(".entry-comments").is(":hidden") && e(t)
        }), c(document).on("click", ".comments-pagination a", function() {
            var t = c(this),
                e = t.attr("href").match(/commentpage-([0-9]+)/)[1],
                n = t.parents(".entry-comments").data("post-id"),
                o = c("#entry_comments_" + n);
            o.prepend('<div class="donut--full"><div class="donut"></div></div>');
            var i = {
                action: "ajax_load_comments",
                nonce: wps_ajax.nonce,
                post_id: n,
                cpage: e
            };
            return jQuery.post(wps_ajax.url, i, function(t) {
                o.html(t), b() > o.offset().top && c([document.documentElement, document.body]).animate({
                    scrollTop: o.offset().top
                }, 100)
            }), !1
        }), c(document).on("journalx_load_comments", function() {
            window.addComment.init()
        }), c(document).on("click", ".more-link", function() {
            window.location.href = c(this).attr("href"), window.onbeforeunload = function() {
                window.scrollTo(0, 0)
            }, window.location.reload(!1)
        }), c(window).scroll(function() {
            i()
        }), c(window).resize(function() {
            i(), n()
        }), n();
        var y = c(".widget-area");

        function i() {
            var t = c(window).width(),
                s = c(window).height();
            if (!(t < 1100)) {
                var r = b(),
                    l = r + 30,
                    e = (t - 1160) / 2,
                    d = l + y.height();
                y.css("right", e), c(".entry-content").each(function() {
                    var t = c(this),
                        e = t.offset().top;
                    if (e - s < r) {
                        var n = t,
                            o = n.offset().top,
                            i = o + n.height(),
                            a = !1;
                        c(".content-wide, .content-right").each(function() {
                            var t = c(this),
                                e = t.offset().top,
                                n = e + t.height();
                            e < d && l < n && (a = !0)
                        }), o < l && d < i && !a ? y.addClass("is-active") : y.removeClass("is-active")
                    }
                })
            }
        }

        function a() {
            var t = c(".js-search-screen"),
                e = c("body");
            c(".site-content").removeClass("blur"), t.removeClass("open"), setTimeout(function() {
                t.css("display", "none")
            }, 10), c(".js-search-icon").removeClass("close"), e.removeClass("scroll-locked"), e.css("padding-right", "")
        }
        i(), c(".js-search-icon").on("click", function() {
            c("#site-navigation-mobile").is(":visible") && (s.toggleClass("open"), k.find("#site-navigation-mobile").slideToggle());
            var t = c(".js-search-screen"),
                e = c(this),
                n = c("body");
            if (t.is(":visible")) a();
            else {
                c(".site-content").addClass("blur"), t.css("display", "block"), t.find(".search-field").focus(), setTimeout(function() {
                    t.addClass("open")
                }, 10), e.addClass("close");
                var o = n.outerWidth();
                n.addClass("scroll-locked");
                var i = n.outerWidth() - o;
                n.css("padding-right", i + "px")
            }
        });
        var s = c(".js-humburger"),
            r = c("#site-navigation"),
            l = c("#header_menu"),
            j = c("#top-menu"),
            x = c(".widget-mobile-menu ul"),
            k = c(".js-mobile-menu-placeholder"),
            C = j.clone(),
            T = x.clone();
        C.find("li").addClass("only-hamburger"), T.find("li").addClass("only-hamburger"), k.append(r.clone().attr("id", "site-navigation-mobile")), s.on("click", function() {
            c(".js-search-screen").is(":visible") && a(), s.toggleClass("open"), k.find("#site-navigation-mobile").slideToggle()
        }), l.prepend(C.html()), l.append(T.html());
        var Q, E = c(window).width();

        function U() {
            c(".main-navigation .menu-item .sub-menu").slideUp(200)
        }
        991 < E && (c(".main-navigation .menu-item a, .main-navigation .menu-item .removed-link").on("mouseenter", function() {
            c(this).parent().parent().find(".sub-menu:visible").hide(), c(this).parent().find(".sub-menu:first").show(), clearTimeout(Q)
        }), c(".main-navigation").on({
            mouseenter: function() {
                clearTimeout(Q)
            },
            mouseleave: function() {
                Q = setTimeout(U, 400)
            }
        })), E <= 991 && (c(".main-navigation").on("click", ".menu-item-has-children", function(t) {
            "A" != t.target.nodeName && "a" != t.target.nodeName && (t.stopPropagation(), c(this).toggleClass("open"), c(this).find(".sub-menu:first").slideToggle())
        }), c("#footer_menu").on("click", ".menu-item-has-children", function(t) {
            "A" != t.target.nodeName && "a" != t.target.nodeName && (t.stopPropagation(), c(this).toggleClass("open"), c(this).find(".sub-menu:first").slideToggle())
        })), c(".sidebar-navigation").on("click", ".menu-item-has-children", function(t) {
            "A" != t.target.nodeName && "a" != t.target.nodeName && (t.stopPropagation(), c(this).toggleClass("open"), c(this).find(".sub-menu:first").slideToggle())
        }), c(".entry-content table").wrap(c("<div class='table-responsive' />")), c(document).on("journalx_load_post", function() {
            setTimeout(function() {
                c(".entry-content table").wrap(c("<div class='table-responsive' />"))
            }, 100)
        }), c(".js-social-link").click(function() {
            var t = jQuery(this).data("uri");
            window.open(t, "_blank")
        }), c(document).on("click", ".js-star-rating-item", function() {
            var i = c(this),
                a = i.parent(),
                s = i.data("score"),
                t = a.data("post-id"),
                r = a.data("rating-count"),
                l = a.data("rating-sum"),
                d = a.data("rating-value");
            if (!a.hasClass("disabled")) {
                a.addClass("disabled process");
                var e = {
                    action: "wpshop_star_rating_submit",
                    nonce: wps_ajax.nonce,
                    post_id: t,
                    score: s,
                    rating_count: r,
                    rating_sum: l,
                    rating_value: d
                };
                jQuery.post(wps_ajax.url, e, function(t) {
                    if (t.success) {
                        var e;
                        d = ((l += s) / ++r).toFixed(2);
                        var n = c("html").attr("lang");
                        "en-US" == n && (e = "assessment"), "ru-RU" == n && (e = ["оценка", "оценки", "оценок"][4 < (o = r) % 100 && o % 100 < 20 ? 2 : [2, 0, 1, 1, 1, 2][o % 10 < 5 ? o % 10 : 5]]), i.parent().parent().find(".star-rating-text").html("<em>( <strong>" + r + "</strong> " + e + ", " + settings_array.rating_text_average + " <strong>" + d + "</strong> " + settings_array.rating_text_from + " <strong>5</strong> )</em></div>")
                    } else t.data;
                    var o;
                    a.removeClass("process")
                })
            }
        }), c(".js-star-rating-item").on({
            mouseenter: function() {
                c(this).parent().hasClass("disabled") || (c(this).parent().addClass("hover"), c(this).addClass("hover").prevAll().addClass("hover"))
            },
            mouseleave: function() {
                c(this).parent().hasClass("disabled") || (c(this).parent().removeClass("hover"), c(".js-star-rating-item").removeClass("hover"))
            }
        }), c(document).on("click", ".js-share-link", function() {
            c(this).hasClass("js-share-link-no-window") ? window.location.href = c(this).data("uri") : function(t) {
                var e, n = (screen.height - 436) / 2,
                    o = (screen.width - 626) / 2;
                n < 0 && (n = 0);
                o < 0 && (o = 0);
                e = "top=" + n + ",left=" + o, e += ",height=436,width=626,resizable=no", open(t, "displayWindow", e)
            }(c(this).data("uri"))
        }), jQuery(document).on("click", ".js-link", function(t) {
            var e = jQuery(this).data("href");
            if ("http" != e.substring(0, 4)) {
                var n = base64_decode(e);
                "http" == n.substring(0, 4) && (e = n)
            }
            var o = "self";
            "blank" != jQuery(this).data("target") && "_blank" != jQuery(this).data("target") && "blank" != jQuery(this).attr("target") && "_blank" != jQuery(this).attr("target") || (o = "blank"), "blank" == o ? window.open(e) : document.location.href = e
        }), 1 == settings_array.lightbox_display && (c(".entry-content").find("a:has(img)").wpshoplightbox(), c(document).on("journalx_load_post", function() {
            setTimeout(function() {
                c(".entry-content").find("a:has(img)").wpshoplightbox()
            }, 100)
        }))
    }),
    function(i, a, s) {
        "use strict";
        s && (s.fn.wpshoplightbox = function(t) {
            var e = s(this),
                o = s('<div class="wpshoplightbox-container" role="dialog" tabindex="-1"><div class="wpshoplightbox-bg"></div><div class="wpshoplightbox-inner"><div class="wpshoplightbox-close"><svg width="17" height="17" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M-1-1h19v19h-19z"/><path fill="#fff" d="M8.485 7.071l-7.071-7.071-1.414 1.414 7.071 7.071-7.071 7.071 1.414 1.414 7.071-7.071 7.071 7.071 1.414-1.414-7.071-7.071 7.071-7.071-1.414-1.414-7.071 7.071z"/></svg></div><div class="wpshoplightbox-body"><div class="wpshoplightbox-image"></div></div><div class="wpshoplightbox-caption"></div></div></div>');
            t = t || {}, e.on("click", function() {
                var t = s(this).attr("href"),
                    e = a.createElement("img"),
                    n = s(e);
                if (t.match(/(\.jpg|\.gif|\.jpeg|\.png)$/i)) {
                    n.attr("src", t);
                    o.appendTo("body")[0];
                    return s("head").append('<style id="wpshoplightbox-scroll-style" type="text/css">.wpshoplightbox-scroll{margin-right:' + (i.innerWidth - a.documentElement.clientWidth) + "px;}</style>"), s("body").addClass("wpshoplightbox-scroll"), o.find(".wpshoplightbox-image").html(n), setTimeout(function() {
                        o.addClass("wpshoplightbox--open")
                    }, 10), !1
                }
            }), s(a).on("click", ".wpshoplightbox-body, .wpshoplightbox-close", function() {
                s(a).find(".wpshoplightbox-container").removeClass("wpshoplightbox--open"), setTimeout(function() {
                    s(a).find(".wpshoplightbox-container").remove()
                }, 400), s("body").removeClass("wpshoplightbox-scroll"), s("#wpshoplightbox-scroll-style").remove()
            })
        })
    }(window, document, jQuery), jQuery(function(t) {
        "use strict";
        var e = t(window).width(),
            n = t(".js-scrolltop");
        n.click(function() {
            return t("body,html").animate({
                scrollTop: 0
            }, 500)
        }), t(window).scroll(function() {
            100 < t(this).scrollTop() ? e < 991 ? "on" == n.data("mob") && n.fadeIn() : n.fadeIn() : n.fadeOut()
        })
    }), jQuery(function(t) {
        "use strict";
        t(document).on("click", ".js-spoiler-box-title", function() {
            t(this).toggleClass("active").next().slideToggle()
        })
    }), jQuery(function(e) {
        "use strict";
        e(document).on("click", ".js-table-of-contents-hide", function() {
            var t = e(this).parents(".table-of-contents");
            t.toggleClass("open"), t.hasClass("open") ? (createCookie("wpshop_toc_hide", "", -1), e(".js-table-of-contents-list").slideDown()) : (createCookie("wpshop_toc_hide", "hide"), e(".js-table-of-contents-list").slideUp())
        }), e(document).on("click", '.table-of-contents a[href*="#"]', function(t) {
            e("html,body").stop().animate({
                scrollTop: e(this).parents(".entry-content").find(this.hash).offset().top - 100
            }, 500), t.preventDefault()
        })
    })

function addYandexRTBScripts() {
    if (document.querySelector('script[src*="yandex.ru/ads/system/context.js"]')) return;
    const e = document.head,
        t = document.createElement("script");
    t.innerHTML = "window.yaContextCb=window.yaContextCb||[]", e.appendChild(t);
    const n = document.createElement("script");
    n.src = "https://yandex.ru/ads/system/context.js", n.async = !0, e.appendChild(n)
}

function insertContentAds() {
    const e = document.querySelector('div.entry-content[itemprop="articleBody"]');
    if (!e) return;
    const t = e.querySelectorAll("p");
    if (0 === t.length) return;
    let n = [0];
    for (let e = 7; e < t.length && n.length < 8; e += 7) n.push(e);
    n.forEach(((e, n) => {
        const o = `yandex_rtb_R-A-15627427-1-${n+1}`,
            d = document.createElement("div");
        d.id = o, d.style.margin = "5px";
        const a = t[e];
        a && a.parentNode && a.parentNode.insertBefore(d, a.nextSibling), window.yaContextCb.push((() => {
            Ya.Context.AdvManager.render({
                blockId: "R-A-15627427-1",
                renderTo: o
            })
        }))
    }))
}

function initFloatingAds() {
    function e() {
        const e = document.getElementById("ya-float-ads");
        e && e.remove();
        const t = document.createElement("div");
        t.id = "ya-float-ads", t.style.cssText = "position:fixed;top:95px;right:0;z-index:9999;max-width:480px;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,0.15);", t.innerHTML = '<div id="ya-close" style="cursor:pointer;padding:0;margin:0;background:transparent;border:none;display:block;"><svg width="60" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24.793 6.793a1 1 0 000 1.414L28.586 12l-3.793 3.793a1 1 0 001.414 1.414L30 13.414l3.793 3.793a1 1 0 001.414-1.414L31.414 12l3.793-3.793a1 1 0 00-1.414-1.414L30 10.586l-3.793-3.793a1 1 0 00-1.414 0z" fill="#575C66"></path></svg></div><div id="yandex_rtb_R-A-15627427-5"></div>', document.body.appendChild(t), document.getElementById("ya-close").onclick = function() {
            t.remove()
        }, window.yaContextCb.push((() => {
            Ya.Context.AdvManager.render({
                blockId: "R-A-15627427-5",
                renderTo: "yandex_rtb_R-A-15627427-5"
            })
        }))
    }
    setTimeout(e, 2e3), setInterval(e, 31e3)
}
function showMoeVideoAd(device) {
  if (document.getElementById('mvcontentroll')) return;
  const d = document.createElement("div");
  d.id = "mvcontentroll";
  document.body.append(d);
  const s = document.createElement("script");
  s.src = "https://cdn1.moe.video/p/cr.js";
  s.onload = () => {
    addContentRoll({
      element: '#mvcontentroll',
      width: '100%',
      placement: 10444,
      promo: true,
      advertCount: 50,
      slot: 'page',
      sound: 'onclick',
      deviceMode: device,
      background: 'none',
      fly: {
        mode: 'always',
        animation: 'fly',
        width: 450,
        closeSecOffset: 10,
        position: 'bottom-right',
        indent: { left: 0, right: 0, top: 0, bottom: 0 },
        positionMobile: 'bottom'
      }
    });
  };
  document.body.append(s);
}

document.addEventListener("DOMContentLoaded", () => {
  const isMobile = window.innerWidth < 768;
  const isHome = ["/", "/index.html"].includes(window.location.pathname);
  const hasCategory = document.querySelector(".post-box__category");

  window.yaContextCb = window.yaContextCb || [];

  if (isMobile) {
    window.yaContextCb.push(() => {
      Ya.Context.AdvManager.render({
        blockId: "R-A-15627427-4",
        type: "floorAd",
        platform: "touch",
        onClose: () => showMoeVideoAd("mobile")
      });
    });
  }

  window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
      blockId: isMobile ? "R-A-15627427-3" : "R-A-15627427-2",
      type: "fullscreen",
      platform: isMobile ? "touch" : "desktop"
    });
  });

  if (!isMobile && !isHome && !hasCategory) {
    setTimeout(() => {
      const id = "ya-float-ads";
      const e = document.getElementById(id);
      if (e) e.remove();
      const d = document.createElement("div");
      d.id = id;
      d.style.cssText = "position:fixed;top:95px;right:0;z-index:9999;max-width:480px;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,0.15)";
      d.innerHTML = '<div id="ya-close" style="cursor:pointer;"><svg width="60" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24.793 6.793a1 1 0 000 1.414L28.586 12l-3.793 3.793a1 1 0 001.414 1.414L30 13.414l3.793 3.793a1 1 0 001.414-1.414L31.414 12l3.793-3.793a1 1 0 00-1.414-1.414L30 10.586l-3.793-3.793a1 1 0 00-1.414 0z" fill="#575C66"></path></svg></div><div id="yandex_rtb_R-A-15627427-5"></div>';
      document.body.appendChild(d);
      document.getElementById("ya-close").onclick = () => d.remove();
      window.yaContextCb.push(() => {
        Ya.Context.AdvManager.render({
          blockId: "R-A-15627427-5",
          renderTo: "yandex_rtb_R-A-15627427-5"
        }, () => {});
      });
    }, 2000);
    setInterval(() => {
      const e = document.getElementById("ya-float-ads");
      if (e) e.remove();
      const d = document.createElement("div");
      d.id = "ya-float-ads";
      d.style.cssText = "position:fixed;top:95px;right:0;z-index:9999;max-width:480px;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,0.15)";
      d.innerHTML = '<div id="ya-close" style="cursor:pointer;"><svg width="60" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24.793 6.793a1 1 0 000 1.414L28.586 12l-3.793 3.793a1 1 0 001.414 1.414L30 13.414l3.793 3.793a1 1 0 001.414-1.414L31.414 12l3.793-3.793a1 1 0 00-1.414-1.414L30 10.586l-3.793-3.793a1 1 0 00-1.414 0z" fill="#575C66"></path></svg></div><div id="yandex_rtb_R-A-15627427-5"></div>';
      document.body.appendChild(d);
      document.getElementById("ya-close").onclick = () => d.remove();
      window.yaContextCb.push(() => {
        Ya.Context.AdvManager.render({
          blockId: "R-A-15627427-5",
          renderTo: "yandex_rtb_R-A-15627427-5"
        }, () => {});
      });
    }, 31000);
  }

  if (window.innerWidth >= 1024) showMoeVideoAd("desktop");
});
